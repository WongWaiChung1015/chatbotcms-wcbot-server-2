"use strict";function LoadShoppingCart(){return $.ajax({method:"GET",url:"ws/db_loadcart",data:{uid:window._userId,rid:window._recipientId}})}function DoCheckout(){var t="mwp?page=orderInfoInput&uid="+window._userId+"&rid="+window._recipientId;null!=window._orderId&&""!=window._orderId&&(t+="&oid="+window._orderId),window.location.href=t}function SaveCart(t){var e=util.CloneObject(window._shoppingCart);delete e.server_settings,$.ajax({type:"POST",url:"ws/db_savecart",data:JSON.stringify({userId:window._userId,recipientId:window._recipientId,cart:e}),contentType:"application/json"}).done(function(e){"ok"===e&&t&&t(!0)}).fail(function(e,n,i){$.alert({type:"red",useBootstrap:!1,title:e,content:i.responseText}),t&&t(!1)})}function getItemStock(t){return $.ajax({type:"GET",url:"ws/get_item_stock",data:{fb_page_id:_recipientId,item_id:t},contentType:"application/json",dataType:"json"})}function findItemInCart(t){for(var e=0;e<window._shoppingCart.cart_items.length;++e){var n=window._shoppingCart.cart_items[e];if(n.product_id==t)return n}}function CalculateTotal(){var t=0;$(".card").each(function(e,n){var i=findItemInCart($(this).data("itemid"));t+=parseInt(i.qty)*parseFloat(i.unit_price)});var e=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,t);$("#amount").html(e)}function RemoveItemFromCart(t){for(var e=[],n=0;n<window._shoppingCart.cart_items.length;++n){var i=window._shoppingCart.cart_items[n];i.product_id!=t&&e.push(i)}window._shoppingCart.cart_items=e,RenderCartAndSetupEvent()}function EnableAllButtons(t){t?$("#btn_checkout").removeClass("disabled loading"):$("#btn_checkout").addClass("disabled loading")}function RenderCartToElem(){var t=window._shoppingCart.cart_items,e=$("#cartItem").html(),n="";if(0===t.length)n="No items in shopping cart. Please close this window and add item to cart in Messenger";else for(var i=0;i<t.length;++i){for(var r=t[i],o="",a=1;a<100;a++)a!=r.qty?o+='<option value="'+a+'">'+a+"</option>":o+='<option value="'+a+'" selected="selected">'+a+"</option>";var d=r.qty*parseFloat(r.unit_price),c=util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,d,!1);n+=e.replace(/item_image/g,r.image).replace(/item_itemName/g,r.name).replace(/item_itemId/g,r.product_id).replace(/item_unitPrice/g,numeral(r.unit_price).format("0,0[.]00")).replace(/item_subTotal/g,c).replace(/item_qtyDropDown/g,o)}$("#cartitems_div").html(n),0===t.length&&$("#btn_checkout").attr("disabled","disabled"),CalculateTotal()}function RenderCartAndSetupEvent(){RenderCartToElem();window._shoppingCart.cart_items;$(".item_qty").off().on("change",function(t){var e=t.target.value,n=t.target.id,i=findItemInCart(n),r=$(this);getItemStock(n).done(function(n){var o=!n.manage_stock;if(n.manage_stock&&n.in_stock&&n.stock_quantity>=e&&(o=!0),o){i.qty=e;var a=e*i.unit_price,d="Sub-total: "+util.ParseCurrencyToDisp(window._shoppingCart.server_settings.currency,a,!1);return $(t.target).closest(".card").find(".sub_total").html(d),SaveCart(),CalculateTotal(),!0}return $.alert({type:"red",useBootstrap:!1,title:"Sorry! Insufficient Stock",content:"We've stock on hand: "+n.stock_quantity,onClose:function(){r.val(i.qty)}}),!1}).fail(function(t,e,n){$.alert({type:"red",useBootstrap:!1,title:t,content:n.responseText})})}),$(".btn_remove").off().on("click",function(t){RemoveItemFromCart($(this).data("itemid")),SaveCart()})}$(document).ready(function(){$(".loading_wrapper").hide(),$(".loaded_wrapper").show(),RenderCartAndSetupEvent(),$(".main.menu").visibility({type:"fixed"}),$(".overlay").visibility({type:"fixed",offset:80}),$(".image").visibility({type:"image",transition:"vertical flip in",duration:500}),$(".main.menu .ui.dropdown").dropdown({on:"hover"}),$("#btn_checkout").on("click",function(t){EnableAllButtons(!1),SaveCart(function(t){t&&DoCheckout()})})});