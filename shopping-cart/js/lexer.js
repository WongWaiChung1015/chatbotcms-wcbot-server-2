function Lexer(a){"function"!=typeof a&&(a=Lexer.defunct);var l=[],x=[],o=0;function c(){for(var t=[],e=0,i=this.state,r=this.index,n=this.input,s=0,h=x.length;s<h;s++){var a=x[s],l=a.start,o=l.length;if(!o||0<=l.indexOf(i)||i%2&&1===o&&!l[0]){var c=a.pattern;c.lastIndex=r;var u=c.exec(n);if(u&&u.index===r){var f=t.push({result:u,action:a.action,length:u[0].length});for(a.global&&(e=f);--f>e;){var d=f-1;if(t[f].length>t[d].length){var p=t[f];t[f]=t[d],t[d]=p}}}}}return t}this.state=0,this.index=0,this.input="",this.addRule=function(t,e,i){var r=t.global;if(!r){var n="g";t.multiline&&(n+="m"),t.ignoreCase&&(n+="i"),t=new RegExp(t.source,n)}return"[object Array]"!==Object.prototype.toString.call(i)&&(i=[0]),x.push({pattern:t,global:r,action:e,start:i}),this},this.setInput=function(t){return o=0,this.state=0,this.index=0,l.length=0,this.input=t,this},this.lex=function(){if(l.length)return l.shift();for(this.reject=!0;this.index<=this.input.length;){for(var t=c.call(this).splice(o),e=this.index;t.length&&this.reject;){var i=t.shift(),r=i.result,n=i.length;this.index+=n,this.reject=!1,o++;var s=i.action.apply(this,r);if(this.reject)this.index=r.index;else if(void 0!==s)switch(Object.prototype.toString.call(s)){case"[object Array]":l=s.slice(1),s=s[0];default:return n&&(o=0),s}}var h=this.input;if(e<h.length){if(this.reject){if(void(o=0)!==(s=a.call(this,h.charAt(this.index++))))return"[object Array]"===Object.prototype.toString.call(s)?(l=s.slice(1),s[0]):s}else this.index!==e&&(o=0),this.reject=!0}else{if(!t.length)break;this.reject=!0}}}}"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Lexer),Lexer.defunct=function(t){throw new Error("Unexpected character at index "+(this.index-1)+": "+t)};